<%= javascript_include_tag 'upload_recording', 'data-turbo-track': 'reload' %>
<%= javascript_include_tag 'compositions_show', 'data-turbo-track': 'reload' %>

<%= content_for :standalone_layout do %>
  <div class="main-wrapper">
    <div class="composition-edit-container">
      <h2><i class="fa-solid fa-sliders"></i>&nbsp &nbsp Modifier les accords de ta composition</h2>

      <!-- Affichage des informations de la composition -->
      <div class="composition-details" data-composition-id="<%= @composition.id %>">
        <ul>
          <li><h1><%= @composition.title %></h1></li>
          <div class="badges-container">
            <span class="badge">
              <i class="fa-solid fa-music"></i>
              <%= @composition.key_signature %>
            </span>
            <span class="badge">
              <i class="fa-solid <%= @composition.mood == 'majeur' ? 'fa-sun' : 'fa-cloud-rain' %>"></i>
              <%= @composition.mood.capitalize %>
            </span>
          </div>
        </ul>
      </div>

      <!-- Liste des accords à ajouter -->
      <div class="accords">
        <h3>Accords à ajouter</h3>
        <ul id="sample-list">
          <% audio_files = [
            { src: "/audios/Do-Lam/Do7.mp3", id: "snd1" },
            { src: "/audios/Do-Lam/Fa.mp3", id: "snd2" },
            { src: "/audios/Do-Lam/Lam7.mp3", id: "snd3" },
            { src: "/audios/Do-Lam/Mi m.mp3", id: "snd4" },
            { src: "/audios/Do-Lam/Ré m.mp3", id: "snd5" },
            { src: "/audios/Do-Lam/Sim5-.mp3", id: "snd6" },
            { src: "/audios/Do-Lam/Sol.mp3", id: "snd7" },
            { src: "/audios/Sol-Mim/Do7.mp3", id: "snd8" },
            { src: "/audios/Sol-Mim/Lam7.mp3", id: "snd10" },
            { src: "/audios/Sol-Mim/Mim.mp3", id: "snd11" },
            { src: "/audios/Sol-Mim/Ré7.mp3", id: "snd12" },
            { src: "/audios/Sol-Mim/Sim7.mp3", id: "snd13" },
            { src: "/audios/Sol-Mim/Solmaj7.mp3", id: "snd14" }
          ] %>

          <% audio_files.each do |audio| %>
            <% filename = File.basename(audio[:src], File.extname(audio[:src])) %>

            <% if @composition.key_signature.downcase == 'do' %>
              <% show_accord = audio[:src].include?('Do-Lam') %>
            <% elsif @composition.key_signature.downcase == 'sol' %>
              <% show_accord = audio[:src].include?('Sol-Mim') %>
            <% elsif @composition.key_signature.downcase == 'mi' %>
              <% show_accord = audio[:src].include?('Sol-Mim') %>
            <% elsif @composition.key_signature.downcase == 'la' %>
              <% show_accord = audio[:src].include?('Do-Lam') %>
            <% else %>
              <% show_accord = false %>
            <% end %>

            <% if show_accord %>
              <li>
                <div class="sample-container">
                  <button class="audio-button" data-audio-id="<%= audio[:id] %>">
                    <i class="fa-solid fa-circle-play"></i>
                    <div><%= filename %></div>
                  </button>
                  <button class="add-to-order" data-audio-id="<%= audio[:id] %>">+</button>
                  <audio id="<%= audio[:id] %>">
                    <source src="<%= audio[:src] %>" type="audio/mp3">
                  </audio>
                </div>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>

      <div class="composition players">
        <ul id="selected-order">
          <% @audio_files.each do |audio| %>
            <li data-audio-id="<%= audio.id %>">
              <button class="selected-button" data-audio-id="<%= audio.id %>">
                <i class="fa-solid fa-circle-play"></i>
                <div><%= audio.filename %></div>
              </button>
              <button class="remove-from-order">-</button>
            </li>
          <% end %>
        </ul>
        <div class="composition-actions">
          <button class="button pulse" id="play-sequence">
            <i class="fa-solid fa-play"></i> Jouer ma composition
          </button>
          <button class="button pulse" id="reset-order">
            <i class="fa-solid fa-rotate-right"></i> Réinitialiser
          </button>
        </div>
      </div>

    </div>
  </div>
<% end %>

<%= javascript_pack_tag 'composition_edit', 'data-turbo-track': 'reload' %> <!-- Inclure le JS externe -->
